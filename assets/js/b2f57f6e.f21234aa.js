(self.webpackChunkguzzle=self.webpackChunkguzzle||[]).push([[5633],{3905:function(e,t,r){"use strict";r.d(t,{Zo:function(){return l},kt:function(){return k}});var a=r(7294);function n(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function i(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function s(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?i(Object(r),!0).forEach((function(t){n(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function o(e,t){if(null==e)return{};var r,a,n=function(e,t){if(null==e)return{};var r,a,n={},i=Object.keys(e);for(a=0;a<i.length;a++)r=i[a],t.indexOf(r)>=0||(n[r]=e[r]);return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)r=i[a],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}var u=a.createContext({}),c=function(e){var t=a.useContext(u),r=t;return e&&(r="function"==typeof e?e(t):s(s({},t),e)),r},l=function(e){var t=c(e.components);return a.createElement(u.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},p=a.forwardRef((function(e,t){var r=e.components,n=e.mdxType,i=e.originalType,u=e.parentName,l=o(e,["components","mdxType","originalType","parentName"]),p=c(r),k=n,g=p["".concat(u,".").concat(k)]||p[k]||d[k]||i;return r?a.createElement(g,s(s({ref:t},l),{},{components:r})):a.createElement(g,s({ref:t},l))}));function k(e,t){var r=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var i=r.length,s=new Array(i);s[0]=p;var o={};for(var u in t)hasOwnProperty.call(t,u)&&(o[u]=t[u]);o.originalType=e,o.mdxType="string"==typeof e?e:n,s[1]=o;for(var c=2;c<i;c++)s[c]=r[c];return a.createElement.apply(null,s)}return a.createElement.apply(null,r)}p.displayName="MDXCreateElement"},4671:function(e,t,r){"use strict";r.r(t),r.d(t,{frontMatter:function(){return o},metadata:function(){return u},toc:function(){return c},default:function(){return d}});var a=r(2122),n=r(9756),i=(r(7294),r(3905)),s=["components"],o={id:"how_key_vault_is_used_to_integrate_guzzle",title:"Use Azure Key Vault with Guzzle"},u={unversionedId:"how_to_guides/features/how_key_vault_is_used_to_integrate_guzzle",id:"how_to_guides/features/how_key_vault_is_used_to_integrate_guzzle",isDocsHomePage:!1,title:"Use Azure Key Vault with Guzzle",description:"Azure Key Vault",source:"@site/docs/how_to_guides/features/how_key_vault_is_used_to_integrate_guzzle.md",sourceDirName:"how_to_guides/features",slug:"/how_to_guides/features/how_key_vault_is_used_to_integrate_guzzle",permalink:"/guzzle_docs/docs/how_to_guides/features/how_key_vault_is_used_to_integrate_guzzle",editUrl:"https://github.com/ja-guzzle/docs/blob/master/docs/how_to_guides/features/how_key_vault_is_used_to_integrate_guzzle.md",version:"current",frontMatter:{id:"how_key_vault_is_used_to_integrate_guzzle",title:"Use Azure Key Vault with Guzzle"},sidebar:"sideBar",previous:{title:"Guzzle CLI",permalink:"/guzzle_docs/docs/how_to_guides/features/guzzle_cli"},next:{title:"Connection and Environment",permalink:"/guzzle_docs/docs/how_to_guides/connection_and_environment/connection_and_environment"}},c=[{value:"Azure Key Vault",id:"azure-key-vault",children:[]},{value:"Integrate key vault with Guzzle",id:"integrate-key-vault-with-guzzle",children:[{value:"Prerequisite:",id:"prerequisite",children:[]},{value:"User-Assigned Managed Identity:",id:"user-assigned-managed-identity",children:[]},{value:"Azure Key Vault:",id:"azure-key-vault-1",children:[]},{value:"Databricks Workspace",id:"databricks-workspace",children:[]}]},{value:"Azure Key Vault vs Databricks secret scope use:",id:"azure-key-vault-vs-databricks-secret-scope-use",children:[{value:"Azure Key Vault",id:"azure-key-vault-2",children:[]},{value:"Databricks Secret Scope",id:"databricks-secret-scope",children:[]}]}],l={toc:c};function d(e){var t=e.components,r=(0,n.Z)(e,s);return(0,i.kt)("wrapper",(0,a.Z)({},l,r,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h2",{id:"azure-key-vault"},"Azure Key Vault"),(0,i.kt)("p",null,(0,i.kt)("a",{parentName:"p",href:"https://docs.microsoft.com/en-us/azure/key-vault/general/overview"},"Azure Key Vault")," is a cloud-based service that helps to store cryptographic keys and secrets used by apps and services.\nIt is centralizing storage of application secrets that allows user to control their distribution."),(0,i.kt)("h2",{id:"integrate-key-vault-with-guzzle"},"Integrate key vault with Guzzle"),(0,i.kt)("p",null,"When using Key Vault, Guzzle no longer need to store secrets and passwords value in application. User can configure Key Vault name and Secret key instead of native secrets and password in Guzzle.\nAzure key vault requires proper authentication and authorization to get access of secrets. Guzzle uses the managed identity to access Azure Key Vault resource."),(0,i.kt)("h3",{id:"prerequisite"},"Prerequisite:"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"Guzzle VM"),(0,i.kt)("li",{parentName:"ol"},"User-Assigned Managed Identity"),(0,i.kt)("li",{parentName:"ol"},"Azure Key Vault"),(0,i.kt)("li",{parentName:"ol"},"Databricks Workspace")),(0,i.kt)("h3",{id:"user-assigned-managed-identity"},"User-Assigned Managed Identity:"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"Create user-assigned managed identity in resource group by click on ",(0,i.kt)("inlineCode",{parentName:"li"},"+Create")," button. "),(0,i.kt)("li",{parentName:"ol"},"Assign a user-assigned managed identity to Guzzle VM by navigating to the Guzzle VM and click Identity, User assigned and then ",(0,i.kt)("inlineCode",{parentName:"li"},"+Add"),". for more detailed steps click ",(0,i.kt)("a",{parentName:"li",href:"https://docs.microsoft.com/en-us/azure/active-directory/managed-identities-azure-resources/qs-configure-portal-windows-vm#assign-a-user-assigned-managed-identity-to-an-existing-vm"},"here"))),(0,i.kt)("h3",{id:"azure-key-vault-1"},"Azure Key Vault:"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"Create azure key vault in resource group by click on ",(0,i.kt)("inlineCode",{parentName:"li"},"+Create")," button."),(0,i.kt)("li",{parentName:"ol"},"Add Access Policy for user-assigned managed identity and databricks workspace by navigating to Azure Key Vault and click on Access Policy, ",(0,i.kt)("inlineCode",{parentName:"li"},"+ Add Access Policy"),".",(0,i.kt)("a",{href:"https://guzzle.justanalytics.com/img/docs/how-to-guides/features/kv_create_access_policy.png",target:"_self"},(0,i.kt)("img",{width:"1000",src:"/img/docs/how-to-guides/features/kv_create_access_policy.png"}))),(0,i.kt)("li",{parentName:"ol"},"Select Configure from template as Secret Management and Select user-assigned managed identity as Principle click on ",(0,i.kt)("inlineCode",{parentName:"li"},"Add")," to create access policy."),(0,i.kt)("li",{parentName:"ol"},"Do same thing for AzureDatabricks principle.",(0,i.kt)("a",{href:"https://guzzle.justanalytics.com/img/docs/how-to-guides/features/kv_access_policies.png",target:"_self"},(0,i.kt)("img",{width:"1000",src:"/img/docs/how-to-guides/features/kv_access_policies.png"})))),(0,i.kt)("h3",{id:"databricks-workspace"},"Databricks Workspace"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"Create Databricks Workspace in resource group by click on ",(0,i.kt)("inlineCode",{parentName:"li"},"+Create")," button."),(0,i.kt)("li",{parentName:"ol"},"After that we create an Azure Key Vault-backed secret scope using the UI."),(0,i.kt)("li",{parentName:"ol"},"Go to ",(0,i.kt)("inlineCode",{parentName:"li"},"https://<databricks-instance>#secrets/createScope"),". replace databricks-instance with your databricks instance url.")),(0,i.kt)("a",{href:"https://guzzle.justanalytics.com/img/docs/how-to-guides/features/kv_db_workspace_scope.png",target:"_self"},(0,i.kt)("img",{width:"1000",src:"/img/docs/how-to-guides/features/kv_db_workspace_scope.png"})),(0,i.kt)("ol",{start:4},(0,i.kt)("li",{parentName:"ol"},"Enter azure key vault name in scope name field. Scope name must be same as key vault name."),(0,i.kt)("li",{parentName:"ol"},"Enter the DNS Name and Resource ID of Key Vault. These properties you will find by navigating to Azure Key Vault and click on Properties."),(0,i.kt)("li",{parentName:"ol"},"Click ",(0,i.kt)("inlineCode",{parentName:"li"},"Create")," button to create secret scope. For more information visit the ",(0,i.kt)("a",{parentName:"li",href:"https://docs.microsoft.com/en-us/azure/databricks/security/secrets/secret-scopes#--create-an-azure-key-vault-backed-secret-scope"},"databricks create secret scope")," documentation.")),(0,i.kt)("h2",{id:"azure-key-vault-vs-databricks-secret-scope-use"},"Azure Key Vault vs Databricks secret scope use:"),(0,i.kt)("h3",{id:"azure-key-vault-2"},"Azure Key Vault"),(0,i.kt)("p",null,"When the secret value is required inside API, Batch, and Pipeline Execution it will use Microsoft Azure Key Vault API to fetch the secret value."),(0,i.kt)("h3",{id:"databricks-secret-scope"},"Databricks Secret Scope"),(0,i.kt)("p",null,"When jobs in running in databricks cluster and requires secrets value, it will get it using databricks key vault instance."))}d.isMDXComponent=!0}}]);